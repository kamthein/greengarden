{# @var user \App\Entity\User #}

{% extends 'base.html.twig' %}

{% block title %}Profil{% endblock %}

{% block body %}
<div class="wrapper" style="margin-top:1rem;">

            {# FLASH #}
            {% for label, messages in app.flashes %}
                {% for message in messages %}
                    <div style="background:#e8f5e9; border-left:3px solid var(--vertColor); padding:0.6rem 0.9rem; border-radius:0 8px 8px 0; font-size:0.85rem; margin-bottom:1rem; color:#333;">
                        {{ message | raw }}
                    </div>
                {% endfor %}
            {% endfor %}
            
    {{ form_start(form) }}

    {# ===== AVATAR ===== #}
    <div class="gg-details" style="margin-bottom:0.75rem;">
        <div class="gg-details-content" style="text-align:center;">
            <img src="{{ vich_uploader_asset(user.avatar) }}"
                 alt="Avatar"
                 class="gg-avatar">
            <div style="font-weight:700; font-size:1rem; color:var(--vertColor); margin-bottom:0.5rem;">{{ user.nickname }}</div>
            <button type="button" class="gg-edit-toggle" onclick="toggleField('avatar-field')">
                ‚úèÔ∏è Modifier mon avatar
            </button>
            <div id="avatar-field" class="gg-field-hidden">
                {{ form_widget(form.avatar) }}
                {{ form_errors(form.avatar) }}
            </div>
        </div>
    </div>

    {# ===== INFOS ===== #}
    <div class="gg-details" style="margin-bottom:0.75rem;">
        <div class="gg-details-content">

            {# MAIL #}
            <div class="gg-profile-row">
                <span class="gg-profile-label">üìß Mail</span>
                <span class="gg-profile-value">{{ user.email }}</span>
            </div>
            <hr class="gg-divider"/>

            {# MOT DE PASSE #}
            <div class="gg-profile-row">
                <span class="gg-profile-label">üîí Mot de passe</span>
                <div style="flex:1;">
                    <button type="button" class="gg-edit-toggle" onclick="toggleField('mdp-field')">
                        ‚úèÔ∏è Modifier
                    </button>
                    <div id="mdp-field" class="gg-field-hidden gg-form-group">
                        <div>
                            {{ form_label(form.newPlainPassword.first, null, {'label_attr': {'class': 'gg-form-label'}}) }}
                            {{ form_widget(form.newPlainPassword.first, {'attr': {'class': 'gg-form-input'}}) }}
                        </div>
                        <div>
                            {{ form_label(form.newPlainPassword.second, null, {'label_attr': {'class': 'gg-form-label'}}) }}
                            {{ form_widget(form.newPlainPassword.second, {'attr': {'class': 'gg-form-input'}}) }}
                        </div>
                        {{ form_errors(form.newPlainPassword) }}
                    </div>
                </div>
            </div>
            <hr class="gg-divider"/>

            {# PSEUDO #}
            <div class="gg-profile-row">
                <span class="gg-profile-label">üë§ Pseudo</span>
                <div style="flex:1; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:0.5rem;">
                    <span class="gg-profile-value">{{ user.nickname }}</span>
                    <button type="button" class="gg-edit-toggle" onclick="toggleField('pseudo-field')">‚úèÔ∏è</button>
                </div>
            </div>
            <div id="pseudo-field" class="gg-field-hidden" style="padding:0.5rem 0;">
                {{ form_widget(form.nickname, {'attr': {'class': 'gg-form-input'}}) }}
                {{ form_errors(form.nickname) }}
            </div>
            <hr class="gg-divider"/>

            {# AGE #}
            <div class="gg-profile-row">
                <span class="gg-profile-label">üéÇ √Çge</span>
                <div style="flex:1; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:0.5rem;">
                    <span class="gg-profile-value">{{ user.age | default('n/a') }}</span>
                    <button type="button" class="gg-edit-toggle" onclick="toggleField('age-field')">‚úèÔ∏è</button>
                </div>
            </div>
            <div id="age-field" class="gg-field-hidden" style="padding:0.5rem 0;">
                {{ form_widget(form.age, {'attr': {'class': 'gg-form-input'}}) }}
                {{ form_errors(form.age) }}
            </div>
            <hr class="gg-divider"/>

            {# TELEPHONE #}
            <div class="gg-profile-row">
                <span class="gg-profile-label">üì± T√©l√©phone</span>
                <div style="flex:1; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:0.5rem;">
                    <span class="gg-profile-value">{{ user.telephone | default('n/a') }}</span>
                    <button type="button" class="gg-edit-toggle" onclick="toggleField('tel-field')">‚úèÔ∏è</button>
                </div>
            </div>
            <div id="tel-field" class="gg-field-hidden" style="padding:0.5rem 0;">
                {{ form_widget(form.telephone, {'attr': {'class': 'gg-form-input'}}) }}
                {{ form_errors(form.telephone) }}
            </div>

        </div>
    </div>

    {# ===== MOT DE PASSE ACTUEL ===== #}
    <div class="gg-details" style="margin-bottom:0.75rem;">
        <div class="gg-details-content">
            <div class="gg-profile-label" style="margin-bottom:0.4rem;">üîë Mot de passe actuel (requis pour enregistrer)</div>
            {{ form_widget(form.actualPlainPassword, {'attr': {'class': 'gg-form-input'}}) }}
            {{ form_errors(form.actualPlainPassword) }}
        </div>
    </div>

    {# ===== BOUTON ENREGISTRER ===== #}
    {{ form_widget(form._token) }}
    <div style="margin-bottom:1rem;">
        {{ form_widget(form.submit, {'attr': {'class': 'gg-action-btn btn-plant gg-submit-btn'}}) }}
    </div>

    {{ form_end(form, {'render_rest': false}) }}

    {# ===== LIENS ===== #}
    <div class="gg-links-footer">
        <a href="{{ path('app_cond') }}" target="_blank" class="gg-link-neutral">CGU</a>
        &nbsp;¬∑&nbsp;
        <a href="{{ path('app_logout') }}" class="gg-link-danger">D√©connexion</a>
    </div>

</div>

<script>
function toggleField(id) {
    const el = document.getElementById(id);
    el.classList.toggle('gg-field-hidden');
}
</script>

{% endblock %}
