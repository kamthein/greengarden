{% extends 'base.html.twig' %}

{% block title %}Potager{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {% if app.user.nbco < 7 %}
        <script src="https://unpkg.com/intro.js/minified/intro.min.js"></script>
    {% endif %}
    {{ encore_entry_script_tags('style') }}
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    {% if app.user.nbco < 7 %}
        <link rel="stylesheet" href="https://unpkg.com/intro.js/minified/introjs.min.css">
    {% endif %}
{% endblock %}

{% block body %}
<div class="wrapper" style="margin-top:0.75rem;">

            {# FLASH #}
            {% for label, messages in app.flashes %}
                {% for message in messages %}
                    <div style="background:#e8f5e9; border-left:3px solid var(--vertColor); padding:0.6rem 0.9rem; border-radius:0 8px 8px 0; font-size:0.85rem; margin-bottom:1rem; color:#333;">
                        {{ message | raw }}
                    </div>
                {% endfor %}
            {% endfor %}

    {# ===== BOUTONS D'ACTION ===== #}
    <div class="gg-actions">
        <a href="{{ path('ajouter_plant', {id: 0}) }}" class="gg-action-btn btn-plant">
            <span class="btn-icon"><img src="{{ asset('images/ajout_plant.png') }}" alt="Plantation" width="28" height="28"></span>
            <span class="btn-label">Plantation</span>
            <span class="btn-dot"></span>
        </a>
        <a href="{{ path('ajouter_recolte', {id: 0}) }}" class="gg-action-btn btn-recolte">
            <span class="btn-icon"><img src="{{ asset('images/ajout_recolte.png') }}" alt="Récolte" width="28" height="28"></span>
            <span class="btn-label">Récolte</span>
            <span class="btn-dot"></span>
        </a>
        <a href="{{ path('ajouter_achat') }}" class="gg-action-btn btn-depense">
            <span class="btn-icon"><img src="{{ asset('images/ajout_achat.png') }}" alt="Dépense" width="28" height="28"></span>
            <span class="btn-label">Dépense</span>
            <span class="btn-dot"></span>
        </a>
        <a href="{{ path('ajouter') }}" class="gg-action-btn btn-note">
            <span class="btn-icon"><img src="{{ asset('images/carnet.png') }}" alt="Note" width="28" height="28"></span>
            <span class="btn-label">Note</span>
            <span class="btn-dot"></span>
        </a>
    </div>

    {# ===== CALENDRIER ===== #}
    {% set date_avt = date|date_modify("first day of this month -1 month")|date('Y-m-d') %}
    {% set date_aps = date|date_modify("first day of this month +1 month")|date('Y-m-d') %}

    <div class="gg-calendar-wrap">
        <div class="gg-calendar-nav">
            <a class="gg-nav-arrow" href="{{ path('carnet', {'date': date_avt}) }}">←</a>
            <strong>{{ date_calendrier_mois }}</strong>
            <a class="gg-nav-arrow" href="{{ path('carnet', {'date': date_aps}) }}">→</a>
        </div>

        <table class="gg-calendar">
            {% set j = 0 %}
            {% for i in 1..date_semaine %}
                <tr>
                    {% for day in jours %}
                        {% if date_premier_jour|date_modify('+' ~ j ~ 'day')|date('d-y-m') == date|date('d-y-m') %}
                            <td class="today">
                        {% else %}
                            <td>
                        {% endif %}
                            {% if i == 1 %}
                                <div class="calendar_week">{{ day }}</div>
                            {% endif %}
                            {% if date_premier_jour|date_modify('+' ~ j ~ 'day')|date('y-m') == date|date('y-m') %}
                                <div class="calendar_day">{{ date_premier_jour|date_modify('+' ~ j ~ 'day')|date('d') }}</div>
                            {% else %}
                                <div class="calendar_day_opacity">{{ date_premier_jour|date_modify('+' ~ j ~ 'day')|date('d') }}</div>
                            {% endif %}
                            <div class="dot-row">
                                {% for ev in events %}
                                    {% if date_premier_jour|date_modify('+' ~ j ~ 'day')|date('d-m-y') == ev.date_event|date('d-m-y') %}
                                        {% if ev.recolte != 0 %}
                                            <a href="{{ path('carnet', {'date': date_premier_jour|date_modify('+' ~ j ~ 'day')|date('y-m-d')}) }}">
                                                <span class="dot dot-rose"></span>
                                            </a>
                                        {% endif %}
                                        {% if ev.plant != 0 %}
                                            <a href="{{ path('carnet', {'date': date_premier_jour|date_modify('+' ~ j ~ 'day')|date('y-m-d')}) }}">
                                                <span class="dot dot-vert"></span>
                                            </a>
                                        {% endif %}
                                        {% if ev.achat != 0 %}
                                            <a href="{{ path('carnet', {'date': date_premier_jour|date_modify('+' ~ j ~ 'day')|date('y-m-d')}) }}">
                                                <span class="dot dot-gris"></span>
                                            </a>
                                        {% endif %}
                                        {% if ev.post != 0 %}
                                            <a href="{{ path('carnet', {'date': date_premier_jour|date_modify('+' ~ j ~ 'day')|date('y-m-d')}) }}">
                                                <span class="dot dot-bleu"></span>
                                            </a>
                                        {% endif %}
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </td>
                        {% set j = j + 1 %}
                    {% endfor %}
                </tr>
            {% endfor %}
        </table>
    </div>

    {# ===== ACTIVITÉ DU JOUR ===== #}
    <div class="gg-section-title">Mon activité du jour</div>

    {{ include('carnet/displayListDayActivity.html.twig', {'fluxes': fluxes_day, 'date': date}) }}

    {# ===== HISTORIQUE ===== #}
    <div class="gg-section-title">Mon historique</div>

    {{ include('carnet/historique/histoPosts.html.twig',   {'fluxPosts':   fluxPosts|reverse,   'user': user}) }}
    {{ include('carnet/historique/histoPlants.html.twig',  {'fluxPaniers': fluxPaniers|reverse, 'user': user}) }}
    {{ include('carnet/historique/histoRecoltes.html.twig',{'fluxPaniers': fluxPaniers|reverse, 'user': user}) }}
    {{ include('carnet/historique/histoAchat.html.twig',   {'fluxAchats':  fluxAchats|reverse,  'user': user}) }}

    {% if app.user == user and fluxPosts is empty and fluxPaniers is empty and fluxAchats is empty %}
    <div class="gg-details" style="text-align:center; padding:1.5rem;">
        <a href="{{ path('ajouter') }}" class="gg-action-btn btn-note" style="display:inline-flex; width:auto;">
            <span class="btn-icon"><img src="{{ asset('images/carnet.png') }}" alt="Note" width="24" height="24"></span>
            <span class="btn-label">Publiez un premier post</span>
        </a>
    </div>
    {% endif %}

</div>
{% endblock %}
